<!DOCTYPE html>
<html>
<head th:replace="layouts/fragments/head"></head>
<body>
<div id="wrapper" class="wrapper bg-ash">
    <!-- Header Menu Area Start Here -->
    <header th:replace="layouts/fragments/admin-header"></header>
    <!-- Header Menu Area End Here -->
    <!-- Page Area Start Here -->
    <div class="dashboard-page-one">
        <!-- Sidebar Area Start Here -->
        <div th:replace="layouts/fragments/admin-sidebar"></div>
        <!-- Sidebar Area End Here -->
        <div class="dashboard-content-one vh-100">
            <!-- Breadcrumbs Area Start Here -->
            <div class="breadcrumbs-area">
                <h3 class="font-weight-bold mb-2"><i class="fa fa-plus-circle" aria-hidden="true"></i> Add School</h3>
                <p class="mb-0">Fill the below details</p>
            </div>
            <div class="row gutters-20 mb-4">
                <div class="col-md-8">
                    <div class="dashboard-summery-one mg-b-20">
                        <div class="add-school mt-2">
                            <form id="#" method="post" enctype="multipart/form-data" action="#">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="form-label">School Name</label>
                                            <input type="text" class="form-control" name="schoolName"
                                                   id="inputSchoolName"
                                                   placeholder="School Name..." required="">
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="form-label">Address</label>
                                            <input type="text" class="form-control" name="address" id="inputAddress"
                                                   placeholder="School Address..." required="">
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="form-label">Contact No.</label>
                                            <input type="tel" class="form-control" name="contactNo" id="inputMobile"
                                                   placeholder="Phone No." maxlength="10" required="">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="form-label">Website</label>
                                            <input type="text" class="form-control" name="website" id="inputWebsite"
                                                   placeholder="www.example.com" required="">
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="form-label">Email</label>
                                            <input type="email" class="form-control" name="email" id="inputEmail"
                                                   placeholder="Email ID" required="">
                                            <span style="font-size:14px;" class="mt-2 d-block" id="unique-email"></span>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="inputFedTaxNumber" class="form-label">FED Tax No.</label>
                                            <input type="text" class="form-control" name="fedTaxNo"
                                                   id="inputFedTaxNumber"
                                                   placeholder="123-XXX-XXXX" required="">
                                        </div>
                                    </div>

                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="form-label">DUNS No.</label>
                                            <input type="text" class="form-control" name="dunsNo" id="inputDunsNumber"
                                                   placeholder="156-XXX-7890" required="">
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="form-label">Per Student Fees</label>
                                            <input type="text" class="form-control" id="inputFeeCharges"
                                                   placeholder="e.g. $100" required="">
                                        </div>
                                    </div>
                                </div>

                                <div class="btn-dash text-right mt-3">
                                    <button type="button" data-toggle="modal" data-target="#paymentModal" class="btn btn-primary" id="save">Submit</button>
                                </div>

                            </form>

                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer-wrap-layout1 dash-fot">
                <div class="copyright">&#169;Copyrights <a href="/">ELDT Inc.</a> 2022. All rights reserved.
                    Powered by <a href="#">Winggs</a>
                </div>
            </footer>
        </div>
    </div>
    <!-- Page Area End Here -->
</div>
<div class="modal fade edit-chap-mod payment-modal" id="paymentModal" tabindex="-1" aria-labelledby="paymentModal"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Payment Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="add-school py-0 px-1">
                    <div class="row">
                        <div id="paymentFormId" class="col-lg-12 mx-auto">
                            <p>Download your certificate by providing your payment details</p>
                            <div class="card">
                                <div class="card-header">
                                    <form method="post" enctype="multipart/form-data" action="#">
                                        <div class="form-group">
                                            <label><h6>Card Owner</h6></label>
                                            <input type="text" id="" name="username" placeholder="Card Owner Name"
                                                   required class="form-control ">
                                        </div>

                                        <div class="form-group">
                                            <label><h6>Card number</h6></label>
                                            <div class="input-group">
                                                <input type="text" id="inputCardNumber" name="cardNumber"
                                                       placeholder="Valid card number" class="form-control " required>
                                                <div class="input-group-append">
                                                    <span class="input-group-text text-muted">
                                                    <i class="fa fa-cc-visa mx-1"></i>
                                                    <i class="fa fa-cc-mastercard mx-1"></i>
                                                    <i class="fa fa-cc-amex mx-1"></i>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-sm-8">
                                                <div class="form-group">
                                                    <label><span
                                                            class="hidden-xs"><h6>Expiration Date</h6></span></label>
                                                    <div class="input-group">
                                                        <input type="number" id="inputMonth" placeholder="MM" name=""
                                                               class="form-control" required>
                                                        <input type="number" id="inputYear" placeholder="YY" name=""
                                                               class="form-control" required>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-4">
                                                <div class="form-group mb-4">
                                                    <label><h6>CVV <i class="fa fa-question-circle d-inline"></i></h6>
                                                    </label>
                                                    <input id="inputCsv" type="text" required class="form-control">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="btn-dash col-12 mb-2">
                                                <button type="button" id="payNowButton"
                                                        class="btn btn-primary font-weight-bold w-100 py-2">
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div style="display:none" id="thankId" class="col-md-12 thankpayment text-center pt-4 pb-2">
                            <div class="thn-icon mb-3">
                                <i class="fa fa-check-circle" aria-hidden="true"></i>
                            </div>

                            <div class="thn-content mb-4">
                                <h2>Thank You!</h2>
                                <p>Your payment has been successful</p>
                            </div>
                        </div>

                    </div>


                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
<script src="static/js/main.js"></script>


<script>
    var amount = 0;
    $(document).delegate('#save', 'click', function (e) {
        setTimeout(removeLoader, 3500); //wait for page load PLUS two seconds.
        let headers = null;
        if ($('#inputSchoolName').val() == '') {
          alert('Name field is required');
          e.preventDefault();
        }

        const formData = {
            name: document.getElementById('inputSchoolName').value,
            mobile: document.getElementById('inputMobile').value,
            email: document.getElementById('inputEmail').value,
            address: document.getElementById('inputAddress').value,
            website: document.getElementById('inputWebsite').value,
            fedTaxNo: document.getElementById('inputFedTaxNumber').value,
            dunsNo: document.getElementById('inputDunsNumber').value,
            fee: document.getElementById('inputFeeCharges').value,
        }

        if (!headers) {
            headers = {}
        }

        console.log('FormData',formData);
        $.ajax({
            url: url +'/admin/schools',
            data: JSON.stringify(formData),
            type: "POST",
            contentType: "application/json;charset=utf-8",
            cache: false,
            headers: {
                headers,
                Authorization: 'Bearer ' + localStorage.getItem('access_token')
            },
            success: function (result) {
                $("form").trigger("reset");
                console.log("Response is here : ", result);
                 amount = result.fee;

                 $('#payNowButton').text("Pay $"+ amount);
            },
            error: function (error) {
                console.log("Error : ", error);
                if(error.responseJSON.status == 500){
                    $('#unique-email').html(error.responseJSON.message).css('color', 'red');
                }
            }
        });
    });

    function getSchoolDetail(id){
          let headers = null;
          if (!headers) {
              headers = {}
          }
          $.ajax({
              url: url + `/admin/schools/${id}`,
              type: "GET",
              dataSrc: 'responseData',
               headers: {
                  headers,
                  Authorization: 'Bearer ' + localStorage.getItem('access_token')
              },
              success: function (res) {

              },
              error: function (error) {
                    console.log("Error : ",error)
            }

          });
      };

    $(document).delegate('#payNowButton', 'click', function () {
        let headers = null;

        const formData = {
            cardNumber: $('#inputCardNumber').val(),
            expMonth: $('#inputMonth').val(),
            expYear: $('#inputYear').val(),
            csv: $('#inputCsv').val(),
            price: amount
        }
        if (!headers) {
            headers = {}
        }
        console.log("Payload : " + formData);
        $.ajax({
            url: url + `/payment`,
            data: JSON.stringify(formData),
            type: "POST",
            contentType: "application/json;charset=utf-8",
            cache: false,
            headers: {
                headers,
                Authorization: 'Bearer ' + localStorage.getItem('access_token')
            },
            success: function (result) {
                $("form").trigger("reset");

                $('#paymentFormId').css('display', 'none');
                $('#thankId').css('display', 'block');
            },
            error: function (error) {
                console.log("Error : ",error)
            }
        });
    });




</script>
</body>
</html>