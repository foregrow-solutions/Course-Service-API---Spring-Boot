<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:replace="layouts/fragments/head"></head>
<body id="page-top">
<div id="wrapper" class="wrapper bg-ash">
    <!-- Header Menu Area Start Here -->
    <header th:replace="layouts/fragments/admin-header"></header>
    <!-- Header Menu Area End Here -->
    <!-- Page Area Start Here -->
    <div class="dashboard-page-one">
        <!-- Sidebar Area Start Here -->
        <div th:replace="layouts/fragments/school-sidebar"></div>
        <!-- Sidebar Area End Here -->
        <div class="dashboard-content-one vh-100">
            <!-- Breadcubs Area Start Here -->
            <div class="breadcrumbs-area">
                <h3 class="font-weight-bold mb-2"><i class="fa fa-plus-circle" aria-hidden="true"></i> Add Faculty</h3>
                <p class="mb-0">Fill the below details</p>
            </div>
            <div class="row gutters-20 mb-4">
                <div class="col-md-6">
                    <div class="dashboard-summery-one mg-b-20">
                        <div class="add-school mt-2">
                            <!-----------------------------------Step Form Start-------------------------------------------->
                            <div class="tab-form">
                                <form id="#" method="post" enctype="multipart/form-data" action="#">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">First Name</label>
                                                <input type="text" class="form-control" id="inputFirstName"
                                                       name="firstname" placeholder="e.g. John" required="">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Last Name</label>
                                                <input type="text" class="form-control" id="inputLastName"
                                                       name="lastname" placeholder="e.g. Deo" required="">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Gender</label>
                                                <select class="form-control" name="Gender" id="inputGender">
                                                    <option selected="true" disabled="disabled" value="">Select Gender
                                                    </option>
                                                    <option value="MALE">Male</option>
                                                    <option value="FEMALE">Female</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Email</label>
                                                <input type="email" class="form-control" id="inputEmail" name="email"
                                                       placeholder="example@gmail.com" required="">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Contact No.</label>
                                                <input type="tel" class="form-control" id="inputMobile" name="contactNo"
                                                       placeholder="123-456-7890" maxlength="10" required="">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Address</label>
                                                <input type="text" class="form-control" id="inputAddress" name="address"
                                                       placeholder="Your Address" required="">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">License No.</label>
                                                <input type="text" class="form-control" id="inputLicenseNumber"
                                                       name="licenseNo" placeholder="e.g. L-514-###-###-###" required="">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Total Experience (Min 2 years)</label>
                                                <input type="number" class="form-control" id="inputExp"
                                                       name="experience" placeholder="e.g. 2Yrs" required="">
                                            </div>
                                        </div>
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label class="form-label">Last Company Name</label>
                                                <input type="text" class="form-control" id="inputLastCompanyName"
                                                       name="lastcompanyname" placeholder="Company name" required="">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="btn-dash text-right mt-3">
                                        <button type="button" id="save" class="btn btn-primary ml-2"
                                                onclick="nextPrev(1)">Save & Next
                                        </button>
                                    </div>
                                </form>
                            </div>
                            <div class="tab-form">
                                <form method="post" enctype="multipart/form-data" action="#">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="upload-docm" id="imagePlaceholder"></div>
                                            <div class="form-group">
                                                <label class="form-label d-block">Upload Your Photo</label>
                                                <input type="file" id="uploadImage" name="uploadPhoto" placeholder="" required="">
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="upload-docm" id="licensePlaceholder"></div>
                                            <div class="form-group">
                                                <label class="form-label d-block">Upload License Photo </label>
                                                <input type="file" id="uploadLicensePhoto" name="uploadLicensePhoto" placeholder="" required="">
                                            </div>
                                        </div>

                                    </div>
                                    <div class="btn-dash text-right mt-4">
                                        <button type="button" id="upload" class="btn btn-primary ml-2">Submit</button>
                                    </div>
                                </form>
                            </div>
                            <!-- Circles which indicates the steps of the form: -->
                            <div class="d-none">
                                <span class="step-cont"></span>
                                <span class="step-cont"></span>
                            </div>
                            <!--------------------------------------------Step Form End----------------------------------------------------->
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer-wrap-layout1 dash-fot">
                <div class="copyright">&#169;Copyrights <a href="/">ELDT Inc.</a> 2022. All rights reserved.
                    Powered by <a href="#">Winggs</a>
                </div>
            </footer>
        </div>
    </div>
    <!-- Page Area End Here -->
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript"
        src="https://cdn.datatables.net/v/bs4/jq-3.6.0/dt-1.13.1/sp-2.1.0/datatables.min.js"></script>
<script src="static/js/main.js"></script>
<script>
  var facultyId = null;
      $(document).delegate('#save', 'click', function () {
          let headers = null;
          const formData = {
              firstName: document.getElementById('inputFirstName').value,
              lastName: document.getElementById('inputLastName').value,
              email: document.getElementById('inputEmail').value,
              mobile: document.getElementById('inputMobile').value,
              gender: document.getElementById('inputGender').value,
              exp: document.getElementById('inputExp').value,
              lastCompanyName: document.getElementById('inputLastCompanyName').value,
              licenseNumber: document.getElementById('inputLicenseNumber').value,
              address: document.getElementById('inputAddress').value,
          }
          if (!headers) {
              headers = {}
          }

          console.log('FormData',formData);
          $.ajax({
              url: url +'/schools/' + localStorage.getItem('school_id')+'/facility',
              data: JSON.stringify(formData),
              type: "POST",
              contentType: "application/json;charset=utf-8",
              cache: false,
              headers: {
                  headers,
                  Authorization: 'Bearer ' + localStorage.getItem('access_token')
              },
              success: function (result) {
                  console.log("Response is here : ", result);
                  facultyId=result.id;
                  $("form").trigger("reset");
              },
              error: function () {
                  console.log("Error : ")
              }
          });
      });

      $('#uploadLicensePhoto').on('change', function() {
      let headers = null;
        if (!headers) {
            headers = {}
        }
        var formData = new FormData();
        formData.append('type', "LICENSE");
        formData.append('file', $('#uploadLicensePhoto')[0].files[0]);
        $.ajax({
            type: "POST",
            enctype: 'multipart/form-data',
            url: url + `/faculty/${facultyId}/upload`,
            data: formData,
            processData: false,
            contentType: false,
            cache: false,
            timeout: 600000,
            headers: {
                headers,
                Authorization: 'Bearer ' + localStorage.getItem('access_token')
            },
            success: function (imageUrl) {
                console.log("SUCCESS : ", imageUrl);
                 var img = $("<img>").attr("src", imageUrl);
                $("#licensePlaceholder").append(img);
            },
            error: function (e) {
                console.log("ERROR : ", e);
            }
        });
      });

      $('#uploadImage').on('change', function() {
      let headers = null;
        if (!headers) {
            headers = {}
        }
        var formData = new FormData();
        formData.append('type', "IMAGE");
        formData.append('file', $('#uploadImage')[0].files[0]);
        $.ajax({
            type: "POST",
            enctype: 'multipart/form-data',
            url: url + `/faculty/${facultyId}/upload`,
            data: formData,
            processData: false,
            contentType: false,
            cache: false,
            timeout: 600000,
            headers: {
                headers,
                Authorization: 'Bearer ' + localStorage.getItem('access_token')
            },
            success: function (imageUrl) {
                console.log("SUCCESS : ", imageUrl);
                var img = $("<img>").attr("src", imageUrl);
                $("#imagePlaceholder").append(img);
            },
            error: function (e) {
                console.log("ERROR : ", e);
            }
        });
      });

</script>
<script>
      var currentTab = 0; // Current tab is set to be the first tab (0)
      showTab(currentTab); // Display the current tab

      function showTab(n) {
        // This function will display the specified tab of the form...
        var x = document.getElementsByClassName("tab-form");
        x[n].style.display = "block";
        //... and fix the Previous/Next buttons:
        if (n == 0) {
          document.getElementById("prevBtn").style.display = "none";
        } else {
          document.getElementById("prevBtn").style.display = "inline";
        }
        if (n == (x.length - 1)) {
          document.getElementById("nextBtn").innerHTML = "Submit";
        } else {
          document.getElementById("nextBtn").innerHTML = "Next";
        }
        //... and run a function that will display the correct step indicator:
        fixStepIndicator(n)
      }

      function nextPrev(n) {
        // This function will figure out which tab to display
        var x = document.getElementsByClassName("tab-form");
        // Exit the function if any field in the current tab is invalid:
        if (n == 1 && !validateForm()) return false;
        // Hide the current tab:
        x[currentTab].style.display = "none";
        // Increase or decrease the current tab by 1:
        currentTab = currentTab + n;
        // if you have reached the end of the form...
        if (currentTab >= x.length) {
          // ... the form gets submitted:
          document.getElementById("regForm").submit();
          return false;
        }
        // Otherwise, display the correct tab:
        showTab(currentTab);
      }

      function validateForm() {
        // This function deals with validation of the form fields
        var x, y, i, valid = true;
        x = document.getElementsByClassName("tab-form");
        y = x[currentTab].getElementsByTagName("input");
        // A loop that checks every input field in the current tab:
        for (i = 0; i < y.length; i++) {
          // If a field is empty...
          if (y[i].value == "") {
            // add an "invalid" class to the field:
            y[i].className += " invalid";
            // and set the current valid status to false
            valid = false;
          }
        }
        // If the valid status is true, mark the step as finished and valid:
        if (valid) {
          document.getElementsByClassName("step-cont")[currentTab].className += " finish";
        }
        return valid; // return the valid status
      }

      function fixStepIndicator(n) {
        // This function removes the "active" class of all steps...
        var i, x = document.getElementsByClassName("step-cont");
        for (i = 0; i < x.length; i++) {
          x[i].className = x[i].className.replace(" active", "");
        }
        //... and adds the "active" class on the current step:
        x[n].className += " active";
      }


</script>
</body>
</html>